//SELECT PARA SALDO DE ESTOQUE POR DATA


select E.ID_LOJA, E.DT_MOV, P.CODIGO,P.DESCRICAO, E.SALDO from TB_ESTOQUE E
JOIN TB_PRODUTO P ON (P.ID_PRODUTO = E.ID_PRODUTO AND P.ID_GRUPO_PRODUTO = E.ID_GRUPO_PRODUTO)
where E.ID_ESTOQUE = (select max(ID_ESTOQUE) from TB_ESTOQUE WHERE ID_PRODUTO = E.ID_PRODUTO AND ID_GRUPO_PRODUTO = E.ID_GRUPO_PRODUTO AND DT_MOV =E.DT_MOV AND ID_LOJA = E.ID_LOJA)
AND E.DT_MOV ='09/29/2017'
AND E.ID_LOJA = 2



//OUTRO EXEMPLO

select E.ID_LOJA, E.DT_MOV, P.CODIGO,P.DESCRICAO, E.SALDO from TB_ESTOQUE E
JOIN TB_PRODUTO P ON (P.ID_PRODUTO = E.ID_PRODUTO AND P.ID_GRUPO_PRODUTO = E.ID_GRUPO_PRODUTO)
where E.ID_ESTOQUE = (select max(ID_ESTOQUE) from TB_ESTOQUE WHERE ID_PRODUTO = E.ID_PRODUTO AND ID_GRUPO_PRODUTO = E.ID_GRUPO_PRODUTO AND DT_MOV =E.DT_MOV AND ID_LOJA = E.ID_LOJA)
AND E.DT_MOV >='09/29/2017'
--AND E.ID_LOJA = 2
ORDER BY E.ID_LOJA, P.CODIGO, E.DT_MOV



------

select E.ID_LOJA, P.CODIGO,P.DESCRICAO, SUM(E.SALDO) AS ESTOQUE from TB_ESTOQUE E
JOIN TB_PRODUTO P ON (P.ID_PRODUTO = E.ID_PRODUTO AND P.ID_GRUPO_PRODUTO = E.ID_GRUPO_PRODUTO)
--where E.ID_ESTOQUE = (select max(ID_ESTOQUE) from TB_ESTOQUE WHERE ID_PRODUTO = E.ID_PRODUTO AND ID_GRUPO_PRODUTO = E.ID_GRUPO_PRODUTO AND DT_MOV =E.DT_MOV AND ID_LOJA = E.ID_LOJA)
--AND E.DT_MOV ='07/09/2018'
AND E.ID_LOJA = 1
GROUP BY
E.ID_LOJA, P.CODIGO,P.DESCRICAO
ORDER BY P.DESCRICAO

-----


select E.ID_LOJA, P.CODIGO,P.DESCRICAO,SUM(E.ENTRADA -E.SAIDA)AS SALDO from TB_ESTOQUE E
JOIN TB_PRODUTO P ON (P.ID_PRODUTO = E.ID_PRODUTO AND P.ID_GRUPO_PRODUTO = E.ID_GRUPO_PRODUTO)
WHERE E.ID_LOJA = 1
AND E.DT_MOV >= '06/29/2018'
AND P.CODIGO='2-5'
GROUP BY
 E.ID_LOJA, P.CODIGO,P.DESCRICAO
ORDER BY P.DESCRICAO